!function(){"use strict";var a=angular.module("todoApp",["ngSanitize","storage.service","todo"]);a.controller("MainController",["$scope","$timeout","$document","storageService","todoService",function(a,b,c,d,e){var f=!1;a.title="todo.tab",a.preview=!1,a.showMarkdown=!1,a.markdown="test",a.theme="default",a.bullet="bullet-default";var g=function(b,c){void 0!==c&&(a[b]=c)};d.get(["title","preview","theme","bullet"],function(b){console.log("settings.loaded");for(var c in b){var d=b[c];console.debug('$scope["%s"] was loaded as "%s".',c,d),a.$apply(g(c,d))}}),e.load(function(b){a.$apply(function(){a.todos=b})}),d.listen(function(b){for(var c in b){var d=b[c];console.debug('$scope["%s"] was changed from "%s" to "%s".',c,d.oldValue,d.newValue),a.$apply(g(c,d.newValue))}}),a.$watch("todos",function(){e.todos=a.todos}),a.titleChanged=function(){f&&b.cancel(f),f=b(function(){d.set({title:a.title},function(){console.log("title.saved")}),f=!1},1e3)},a.todosChanged=function(){f&&b.cancel(f),f=b(function(){e.save(),f=!1},1e3)},a.themeChanged=function(){d.set({theme:a.theme},null)},a.bulletChanged=function(){d.set({bullet:a.bullet},null)},a.displayMarkdown=function(){var b=a.title+"\r\n";b+=new Array(a.title.length+1).join("="),b+="\r\n";for(var c in a.todos)b+="- "+a.todos[c].name,b+="\r\n";a.markdown=b,a.showMarkdown=!a.showMarkdown},a.previewMarkdown=function(){a.preview=!a.preview,d.set({preview:a.preview},null)},a.$on("ENTER_PRESSED",function(b,c){var d=e.addTodo(c.afterItem);a.$apply(function(){a.todos=d.todos,console.log(a.todos)})}),a.$on("REMOVE_TODO",function(b,c){if(1!=a.todos.length){var d=e.removeTodo(c.todo);a.$apply(function(){a.todos=d,console.log(a.todos)})}}),c.bind("keydown",function(b){b.ctrlKey&&77==b.keyCode&&a.$apply(function(){a.previewMarkdown()})})}])}();